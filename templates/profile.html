{% extends 'base.html' %}
{% load static %}

{% block content %}
<!-- Font & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<div class="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-indigo-100 px-4 py-16 flex items-center justify-center">
  <div class="w-full max-w-5xl bg-white/90 backdrop-blur-md rounded-[2rem] shadow-[0_15px_60px_rgba(79,70,229,0.2)] p-10 sm:p-14 transition-all duration-700 hover:shadow-[0_20px_80px_rgba(79,70,229,0.35)] animate-fade-in-smooth">

    <!-- Title -->
    <div class="text-center mb-14">
      <h2 class="text-4xl sm:text-5xl font-extrabold text-indigo-700 tracking-wide relative inline-block animate-bounce-slow">
        <span class="bg-gradient-to-r from-indigo-600 via-purple-500 to-pink-500 bg-clip-text text-transparent">My Profile</span>
        <div class="absolute -bottom-2 left-1/2 -translate-x-1/2 w-16 h-[3px] bg-indigo-500 rounded-full animate-pulse"></div>
      </h2>
    </div>

    <!-- Flash Messages -->
    {% if messages %}
      <div class="space-y-3 mb-10 animate-fade-in-down">
        {% for message in messages %}
          <div class="px-6 py-4 rounded-xl flex items-center gap-3 border-l-[5px] shadow-md transition-transform duration-300 hover:translate-x-2
                      {% if message.tags == 'success' %}
                        border-green-600 bg-green-50 text-green-800
                      {% elif message.tags == 'error' %}
                        border-red-600 bg-red-50 text-red-800
                      {% elif message.tags == 'warning' %}
                        border-yellow-600 bg-yellow-50 text-yellow-800
                      {% else %}
                        border-blue-600 bg-blue-50 text-blue-800
                      {% endif %}">
            <i class="fa-solid fa-circle-info text-lg"></i> {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- Profile Update Form -->
    <form method="POST" enctype="multipart/form-data" class="space-y-12 animate-slide-up">
      {% csrf_token %}
      <input type="hidden" name="action" value="update_profile">

      <!-- Profile Image -->
      <div class="flex flex-col md:flex-row items-center gap-10">
        <div class="relative group">
          <div class="relative w-48 h-48 sm:w-56 sm:h-56 rounded-full overflow-hidden shadow-2xl ring-4 ring-indigo-500/60 transition-all duration-500 group-hover:ring-indigo-600 group-hover:scale-105">
            <img id="profileImagePreview" src="{{ profile.image.url }}" alt="Profile Image"
                 class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-500 flex items-center justify-center">
              <span class="text-white font-semibold text-lg tracking-wide">{{ user.username }}</span>
            </div>
          </div>
        </div>
        <div class="flex-1 w-full">
          <label class="block text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
            <i class="fa-solid fa-camera text-indigo-600"></i> Change Profile Image
          </label>
          <input type="file" name="image" id="imageInput"
                 class="block w-full text-sm text-gray-600 file:py-3 file:px-6 file:rounded-2xl file:border-0
                        file:bg-indigo-100 file:text-indigo-700 hover:file:bg-indigo-200 file:transition-all file:duration-300 cursor-pointer" />
        </div>
      </div>

      <!-- Profile Fields -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="relative">
          <i class="fa-solid fa-user absolute top-4 left-4 text-indigo-500"></i>
          <label class="block text-sm font-semibold text-gray-700 mb-1 pl-9">Username</label>
          <input type="text" name="username" value="{{ user.username }}" readonly
                 class="w-full bg-gray-100 text-gray-500 border rounded-2xl px-5 py-4 shadow-inner pl-11 focus:outline-none">
        </div>

        <div class="relative">
          <i class="fa-solid fa-id-badge absolute top-4 left-4 text-indigo-500"></i>
          <label class="block text-sm font-semibold text-gray-700 mb-1 pl-9">First Name</label>
          <input type="text" name="first_name" value="{{ user.first_name|default:'' }}"
                 class="w-full border rounded-2xl px-5 py-4 shadow-md pl-11 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all duration-300">
        </div>

        <div class="relative">
          <i class="fa-solid fa-id-badge absolute top-4 left-4 text-indigo-500"></i>
          <label class="block text-sm font-semibold text-gray-700 mb-1 pl-9">Last Name</label>
          <input type="text" name="last_name" value="{{ user.last_name|default:'' }}"
                 class="w-full border rounded-2xl px-5 py-4 shadow-md pl-11 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all duration-300">
        </div>

        <div class="relative">
          <i class="fa-solid fa-envelope absolute top-4 left-4 text-indigo-500"></i>
          <label class="block text-sm font-semibold text-gray-700 mb-1 pl-9">Email</label>
          <input type="email" name="email" value="{{ user.email|default:'' }}"
                 class="w-full border rounded-2xl px-5 py-4 shadow-md pl-11 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all duration-300">
        </div>
      </div>

      <!-- Save Button -->
      <button type="submit"
              class="w-full py-4 px-6 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-500 text-white font-semibold rounded-2xl
                     hover:shadow-[0_8px_30px_rgba(99,102,241,0.4)] transform hover:-translate-y-1 transition-all duration-300 flex justify-center items-center gap-3">
        <i class="fa-solid fa-pen-to-square"></i> Update Profile
      </button>
    </form>

    <!-- Divider -->
    <div class="relative my-14">
      <hr class="border-gray-300">
      <span class="absolute -top-3 left-1/2 -translate-x-1/2 bg-white px-5 text-gray-400 text-sm font-medium">OR</span>
    </div>

    <!-- Password Change Form -->
    <form method="POST" class="space-y-10 animate-slide-up">
      {% csrf_token %}
      <input type="hidden" name="action" value="update_password">

      <h3 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6 flex items-center gap-2">
        <i class="fa-solid fa-key text-yellow-500"></i> Change Password
      </h3>

      <div class="relative">
        <i class="fa-solid fa-lock absolute top-4 left-4 text-yellow-500"></i>
        <label class="block text-sm font-semibold text-gray-700 mb-1 pl-11">Current Password</label>
        <input type="password" name="current_password"
               class="w-full border rounded-2xl px-5 py-4 shadow-md pl-11 focus:ring-2 focus:ring-yellow-400 focus:outline-none transition-all duration-300" required />
      </div>

      <div class="relative">
        <i class="fa-solid fa-lock absolute top-4 left-4 text-yellow-500"></i>
        <label class="block text-sm font-semibold text-gray-700 mb-1 pl-11">New Password</label>
        <input type="password" name="new_password"
               class="w-full border rounded-2xl px-5 py-4 shadow-md pl-11 focus:ring-2 focus:ring-yellow-400 focus:outline-none transition-all duration-300" required />
      </div>

      <div class="relative">
        <i class="fa-solid fa-lock absolute top-4 left-4 text-yellow-500"></i>
        <label class="block text-sm font-semibold text-gray-700 mb-1 pl-11">Confirm New Password</label>
        <input type="password" name="confirm_new_password"
               class="w-full border rounded-2xl px-5 py-4 shadow-md pl-11 focus:ring-2 focus:ring-yellow-400 focus:outline-none transition-all duration-300" required />
      </div>

      <button type="submit"
              class="w-full py-4 px-6 bg-gradient-to-r from-yellow-400 via-amber-500 to-orange-500 text-white font-semibold rounded-2xl
                     hover:shadow-[0_8px_30px_rgba(234,179,8,0.4)] transform hover:-translate-y-1 transition-all duration-300 flex justify-center items-center gap-3">
        <i class="fa-solid fa-lock-open"></i> Change Password
      </button>
    </form>
  </div>
</div>

<!-- Image Preview Script -->
<script>
  document.getElementById("imageInput").addEventListener("change", function(e) {
    const reader = new FileReader();
    reader.onload = function() {
      document.getElementById("profileImagePreview").src = reader.result;
    };
    if (e.target.files.length > 0) {
      reader.readAsDataURL(e.target.files[0]);
    }
  });
</script>

<!-- Animations -->
<style>
@keyframes fade-in-smooth { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
.animate-fade-in-smooth { animation: fade-in-smooth 0.8s ease-out both; }

@keyframes fade-in-down { from { opacity: 0; transform: translateY(-15px); } to { opacity: 1; transform: translateY(0); } }
.animate-fade-in-down { animation: fade-in-down 0.6s ease-in-out both; }

@keyframes slide-up { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
.animate-slide-up { animation: slide-up 0.6s ease-out both; }

@keyframes bounce-slow {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
}
.animate-bounce-slow { animation: bounce-slow 2s infinite; }
</style>

{% endblock %}
